{"version":3,"sources":["../../src/request/request.shim.js"],"names":[],"mappings":"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","file":"request.shim.js","sourcesContent":["/**!\n *\n * Copyright (c) 2015-2016 Cisco Systems, Inc. See LICENSE file.\n */\n\n/* eslint-env browser */\n\n// Note: several code paths are ignored in this file. As far as I can tell, any\n// error conditions that would provoke those paths are otherwise prevented and\n// reported.\n\nimport {defaults, pick} from 'lodash';\nimport qs from 'qs';\nimport xhr from 'xhr';\n\n/**\n * @name request\n * @param {Object} options\n * @returns {Promise}\n */\nexport default function _request(options) {\n  return new Promise((resolve) => {\n    const params = pick(options, `method`, `uri`, `withCredentials`, `headers`, `timeout`, `responseType`);\n\n    // Set `response` to `true` to approximate an `HttpResponse` object\n    params.response = true;\n\n    bindProgressEvents(params, options);\n    setAuth(params, options);\n    setCookies(params, options);\n    setDefaults(params, options);\n    setFileType(params, options);\n    setPayload(params, options);\n    setQs(params, options);\n\n    const x = xhr(params, (error, response) => {\n      /* istanbul ignore next */\n      if (error) {\n        options.logger.warn(error);\n      }\n\n      /* istanbul ignore else */\n      if (response) {\n        response.options = options;\n        processResponseJson(response, params);\n        resolve(response);\n      }\n      else {\n        resolve({\n          statusCode: 0,\n          options,\n          headers: options.headers,\n          method: options.method,\n          url: options.uri,\n          body: error\n        });\n      }\n    });\n\n    x.onprogress = options.download.emit.bind(options.download, `progress`);\n  })\n  .catch((error) => {\n    /* eslint arrow-body-style: [0] */\n    /* istanbul ignore next */\n    return {\n      statusCode: 0,\n      options,\n      headers: options.headers,\n      method: options.method,\n      url: options.uri,\n      body: error\n    };\n  });\n\n  /**\n   * @param {Object} params\n   * @param {Object} o\n   * @private\n   * @returns {undefined}\n   */\n  function bindProgressEvents(params, o) {\n    if (params.method && [`PATCH`, `POST`, `PUT`].includes(params.method.toUpperCase())) {\n      params.xhr = new XMLHttpRequest();\n      params.xhr.upload.onprogress = o.upload.emit.bind(o.upload, `progress`);\n    }\n  }\n\n  /**\n   * @param {Object} params\n   * @param {Object} o\n   * @private\n   * @returns {undefined}\n   */\n  function setAuth(params, o) {\n    if (o.auth) {\n      if (o.auth.bearer) {\n        params.headers.authorization = `Bearer ${o.auth.bearer}`;\n      }\n      else {\n        const user = o.auth.user || o.auth.username;\n        const pass = o.auth.pass || o.auth.password;\n\n        const token = btoa(`${user}:${pass}`);\n        params.headers.authorization = `Basic ${token}`;\n      }\n    }\n  }\n\n  /**\n   * @param {Object} params\n   * @param {Object} o\n   * @private\n   * @returns {undefined}\n   */\n  function setCookies(params, o) {\n    if (o.jar) {\n      params.withCredentials = true;\n    }\n  }\n\n  /**\n   * @param {Object} params\n   * @param {Object} o\n   * @private\n   * @returns {undefined}\n   */\n  function setDefaults(params, o) {\n    const defs = {\n      cors: true,\n      // raynos/xhr defaults withCredentials to true if cors is true, so we need\n      // to make it explicitly false by default\n      withCredentials: false,\n      timeout: 0\n    };\n\n    defaults(params, pick(o, Object.keys(defs)), defs);\n  }\n\n  /**\n   * @param {Object} params\n   * @param {Object} o\n   * @private\n   * @returns {undefined}\n   */\n  function setFileType(params, o) {\n    if (o.responseType === `buffer`) {\n      params.responseType = `arraybuffer`;\n    }\n  }\n\n  /**\n   * @param {Object} params\n   * @param {Object} o\n   * @private\n   * @returns {undefined}\n   */\n  function setQs(params, o) {\n    if (o.qs) {\n      params.uri += `?${qs.stringify(o.qs)}`;\n    }\n  }\n\n  /**\n   * @param {Object} params\n   * @param {Object} o\n   * @private\n   * @returns {undefined}\n   */\n  function setPayload(params, o) {\n    if ((!(`json` in o) || o.json === true) && o.body) {\n      params.json = o.body;\n    }\n    else if (o.form) {\n      params.headers[`Content-Type`] = `application/x-www-form-urlencoded`;\n      params.body = qs.stringify(o.form);\n      Reflect.deleteProperty(params, `json`);\n    }\n    else {\n      params.body = o.body;\n      Reflect.deleteProperty(params, `json`);\n    }\n  }\n\n  /**\n   * @param {Object} response\n   * @param {Object} params\n   * @private\n   * @returns {undefined}\n   */\n  function processResponseJson(response, params) {\n    // If params.json is not defined, xhr won't deserialize the response\n    // so we should give it a shot just in case.\n    if (!params.json && typeof response.body !== `object`) {\n      try {\n        response.body = JSON.parse(response.body);\n      }\n      catch (e) {\n        /* eslint no-empty: [0] */\n      }\n    }\n  }\n}\n"]}